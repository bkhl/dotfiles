#!/usr/bin/env python3
# coding: utf-8
"""
Pick and launch a screenlayout setup script using rofi.
"""

import os
import subprocess
import sys
from json import JSONDecodeError

import i3ipc

screenlayout_directory = os.path.expanduser('~/.screenlayout/')


def get_label(file_name):
    base, _ = os.path.splitext(file_name)
    label = base.title()
    return label


file_names = os.listdir(screenlayout_directory)

options = {get_label(f): f for f in file_names}

command_input = '\n'.join(sorted(options.keys()))

selection = subprocess.check_output(
    ['rofi', '-dmenu', '-i'], input=command_input, universal_newlines=True)

script_path = os.path.join(screenlayout_directory, options[selection.rstrip()])
rofi_returncode = subprocess.check_call([script_path])

if rofi_returncode != 0:
    sys.exit(rofi_returncode)

i3 = i3ipc.Connection()
try:
    i3.command('restart')
except JSONDecodeError:
    pass
