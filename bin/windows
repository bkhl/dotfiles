#!/usr/bin/env python3

# Starts the VM named 'Windows' and sets the window class to 'Windows'

from time import sleep

from plumbum import local
from plumbum.cmd import wmctrl, xprop

virtualboxvm = local["/usr/lib/virtualbox/VirtualBoxVM"]


def get_window_id(pid):
    for line in wmctrl("-l", "-p").splitlines():
        columns = line.split()
        if int(columns[2]) == pid:
            return columns[0]
    else:
        return None


pid = virtualboxvm.popen(("--startvm", "Windows")).pid

window_id = None
while window_id is None:
    sleep(1)
    window_id = get_window_id(pid)

xprop("-id", window_id, "-f", "WM_CLASS", "8s", "-set", "WM_CLASS", "Windows")
